<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bee Letter Catch - Happy Birthday Zainul</title>
<style>
  * { margin:0; padding:0; box-sizing: border-box; }
  body, html {
    height: 100%;
    background: radial-gradient(ellipse at center, #0a122a 0%, #04081b 100%);
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    user-select: none;
  }
  #game-container {
    max-width: 480px;
    margin: 1em auto;
    position: relative;
  }
  canvas {
    display: block;
    width: 100%;
    height: 640px;
    background: transparent;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(255 204 102 / 0.3);
  }
  #hud {
    margin: 1em 0 0.5em;
    text-align: center;
    font-weight: 600;
    letter-spacing: 2px;
    font-size: 1.2em;
    color: #ffcc66;
  }
  #overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 10;
    flex-direction: column;
  }
  #dialog {
    background: #1a2136;
    padding: 2em 2.5em;
    border-radius: 16px;
    text-align: center;
    max-width: 320px;
    box-shadow: 0 4px 20px rgba(255,204,102,0.6);
  }
  #dialog p {
    font-size: 1.4em;
    margin-bottom: 1.2em;
  }
  #dialog button {
    background: linear-gradient(180deg, #ff7b9a, #ff4f7a);
    border: none;
    border-radius: 9999px;
    padding: 0.7em 2.4em;
    color: white;
    font-weight: 700;
    font-size: 1.2em;
    cursor: pointer;
    box-shadow: 0 6px 14px rgba(255,80,120,0.25);
    transition: background 0.25s ease;
  }
  #dialog button:hover {
    background: linear-gradient(180deg, #ff4f7a, #ff7b9a);
  }
  #final-message {
    font-size: 1.8em;
    margin-top: 1em;
    color: #ffdfc1;
    font-weight: 700;
    text-shadow: 0 0 20px #ffb677;
  }
  #birthday-text {
    font-size: 2.4em;
    font-weight: 900;
    color: #ffdd88;
    text-shadow:
      0 0 10px #ffb600,
      0 0 20px #ffb600,
      0 0 30px #ffb600,
      0 0 40px #ffb600,
      0 0 50px #ffb600,
      0 0 60px #ffb600;
    margin-bottom: 1.2em;
  }
  #stars {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }
</style>
</head>
<body>
  <div id="game-container">
    <div id="hud">Spell: <span id="next-letter"></span></div>
    <canvas id="game" width="480" height="640"></canvas>
  </div>

  <div id="overlay" role="dialog" aria-modal="true" aria-labelledby="dialog-text">
    <div id="dialog" style="display:none;">
      <p id="dialog-text">Do you love Foumi?</p>
      <button id="yes-button">YES</button>
      <div id="final-message" hidden>Foumi loves you most &lt;3</div>
    </div>
    <div id="birthday-text" style="display:none;">HAPPY BIRTHDAYY ZAINUL</div>
    <canvas id="fireworks" width="480" height="200" style="border-radius: 12px;"></canvas>
  </div>

  <canvas id="stars"></canvas>

<script>
(() => {
  const MESSAGE = "HAPPY BIRTHDAY ZAINUL";
  const LETTERS = MESSAGE.split('');
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const starsCanvas = document.getElementById('stars');
  const starsCtx = starsCanvas.getContext('2d');
  const nextLetterEl = document.getElementById('next-letter');
  const overlay = document.getElementById('overlay');
  const dialog = document.getElementById('dialog');
  const dialogText = document.getElementById('dialog-text');
  const yesButton = document.getElementById('yes-button');
  const finalMessage = document.getElementById('final-message');
  const birthdayText = document.getElementById('birthday-text');
  const fireworksCanvas = document.getElementById('fireworks');
  const fwCtx = fireworksCanvas.getContext('2d');

  const W = canvas.width;
  const H = canvas.height;

  // Basket
  let basket = {
    x: W/2 - 60,
    y: H - 60,
    width: 120,
    height: 28,
    speed: 10,
    vx: 0
  };

  // Bee image (simple cartoon bee)
  const beeImg = new Image();
  beeImg.src = 'https://i.imgur.com/OW3ijcr.png'; // cartoon bee with transparent bg

  // Bee properties
  const beeRadius = 28;

  // Speed faster
  const beeSpeed = 2.6;

  // Current bee (carries letter)
  let bee = null;

  // Letter index we want to catch next
  let nextIndex = 0;

  // Stars for background
  const starsCount = 80;
  let stars = [];

  // Fireworks vars
  const fwWidth = fireworksCanvas.width;
  const fwHeight = fireworksCanvas.height;
  let fwParticles = [];

  // Controls
  let keys = {};
  window.addEventListener('keydown', e => {
    keys[e.key] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key] = false;
  });

  // Touch drag support for basket
  let dragging = false;
  let dragOffsetX = 0;
  canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    if(my > basket.y - 40 && mx > basket.x && mx < basket.x + basket.width){
      dragging = true;
      dragOffsetX = mx - basket.x;
      canvas.style.cursor = 'grabbing';
    }
  });
  window.addEventListener('mousemove', e => {
    if(dragging){
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      basket.x = mx - dragOffsetX;
      if(basket.x < 0) basket.x = 0;
      if(basket.x > W - basket.width) basket.x = W - basket.width;
    }
  });
  window.addEventListener('mouseup', e => {
    dragging = false;
    canvas.style.cursor = '';
  });
  canvas.addEventListener('touchstart', e => {
    const rect = canvas.getBoundingClientRect();
    const t = e.touches[0];
    const mx = t.clientX - rect.left;
    const my = t.clientY - rect.top;
    if(my > basket.y - 40 && mx > basket.x && mx < basket.x + basket.width){
      dragging = true;
      dragOffsetX = mx - basket.x;
    }
  }, {passive:false});
  window.addEventListener('touchmove', e => {
    if(dragging){
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const t = e.touches[0];
      const mx = t.clientX - rect.left;
      basket.x = mx - dragOffsetX;
      if(basket.x < 0) basket.x = 0;
      if(basket.x > W - basket.width) basket.x = W - basket.width;
    }
  }, {passive:false});
  window.addEventListener('touchend', e => {
    dragging = false;
  });

  // Stars init and draw
  function initStars() {
    starsCanvas.width = window.innerWidth;
    starsCanvas.height = window.innerHeight;
    stars = [];
    for(let i=0; i<starsCount; i++){
      stars.push({
        x: Math.random()*starsCanvas.width,
        y: Math.random()*starsCanvas.height,
        radius: Math.random()*1.5 + 0.3,
        alpha: Math.random()*0.6 + 0.3,
        delta: (Math.random() * 0.01) + 0.002
      });
    }
  }
  function drawStars(){
    starsCtx.clearRect(0,0,starsCanvas.width, starsCanvas.height);
    stars.forEach(s => {
      s.alpha += s.delta;
      if(s.alpha > 1 || s.alpha < 0.3) s.delta = -s.delta;
      starsCtx.beginPath();
      starsCtx.arc(s.x, s.y, s.radius, 0, 2*Math.PI);
      starsCtx.fillStyle = `rgba(255,255,255,${s.alpha.toFixed(2)})`;
      starsCtx.fill();
    });
  }

  // Fireworks particle system
  class Firework {
    constructor(x,y,color){
      this.x = x;
      this.y = y;
      this.color = color;
      this.particles = [];
      this.createParticles();
    }
    createParticles(){
      for(let i=0; i<40; i++){
        this.particles.push({
          x: this.x,
          y: this.y,
          vx: Math.cos(i*(Math.PI*2/40))* (Math.random()*4 + 2),
          vy: Math.sin(i*(Math.PI*2/40))* (Math.random()*4 + 2),
          life: 1500 + Math.random()*1000,
          size: Math.random()*3 + 2,
          alpha: 1
        });
      }
    }
    update(dt){
      this.particles = this.particles.filter(p => p.life > 0);
      this.particles.forEach(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.life -= dt;
        p.alpha = p.life / 1500;
      });
    }
    draw(ctx){
      this.particles.forEach(p => {
        ctx.fillStyle = `rgba(${this.color},${p.alpha.toFixed(2)})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, 2*Math.PI);
        ctx.fill();
      });
    }
    isDone(){
      return this.particles.length === 0;
    }
  }

  let fireworks = [];

  // Create multiple fireworks at random positions
  function launchFireworks(){
    for(let i=0; i<6; i++){
      fireworks.push(new Firework(
        Math.random()*fwWidth,
        Math.random()*fwHeight*0.6 + fwHeight*0.2,
        `255,${Math.floor(Math.random()*200+50)},${Math.floor(Math.random()*50)}`
      ));
    }
  }

  // Create a new bee object with letter and start x position
  function spawnBee(){
    const letter = LETTERS[nextIndex];
    const x = Math.random()*(W - beeRadius*2) + beeRadius;
    bee = {
      x: x,
      y: -beeRadius*2,
      letter: letter,
      radius: beeRadius,
      caught: false
    };
    nextLetterEl.textContent = letter;
  }

  // Draw bee image with letter on it
  function drawBee(b){
    ctx.drawImage(beeImg, b.x - beeRadius, b.y - beeRadius, beeRadius*2, beeRadius*2);

    // Letter on bee
    ctx.fillStyle = '#3b2a00';
    ctx.font = '28px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(b.letter, b.x, b.y + 4);
  }

  // Draw basket (simple rectangle with rim)
  function drawBasket(){
    ctx.fillStyle = '#8b5e3c';
    ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
    ctx.fillStyle = '#a36b45';
    ctx.fillRect(basket.x, basket.y - 6, basket.width, 8);

    // Cloth inside basket
    ctx.fillStyle = '#ffdfc1';
    ctx.fillRect(basket.x + 8, basket.y + 4, basket.width - 16, 6);

    // Basket shadow
    ctx.beginPath();
    ctx.ellipse(basket.x + basket.width/2, basket.y + basket.height + 8, basket.width/2, 8, 0, 0, 2*Math.PI);
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fill();
  }

  // Check if basket caught the bee (rectangle-circle collision)
  function checkCatch(){
    if(!bee) return false;
    const closestX = Math.max(basket.x, Math.min(bee.x, basket.x + basket.width));
    const closestY = Math.max(basket.y, Math.min(bee.y, basket.y + basket.height));
    const dx = bee.x - closestX;
    const dy = bee.y - closestY;
    const distance = Math.sqrt(dx*dx + dy*dy);
    return distance < bee.radius + 4;
  }

  // Controls and game variables
  let lastTime = 0;
  let running = true;

  // Show overlay with dialog
  function showOverlay(){
    overlay.style.visibility = 'visible';
    overlay.style.opacity = '1';
  }
  // Hide overlay
  function hideOverlay(){
    overlay.style.visibility = 'hidden';
    overlay.style.opacity = '0';
  }

  // Handle YES button click
  yesButton.onclick = () => {
    dialogText.textContent = '';
    yesButton.style.display = 'none';
    finalMessage.hidden = false;
  };

  // Game loop
  function gameLoop(timestamp){
    if(!lastTime) lastTime = timestamp;
    const dt = timestamp - lastTime;
    lastTime = timestamp;

    // Move basket
    if(keys['ArrowLeft']) basket.x -= basket.speed;
    if(keys['ArrowRight']) basket.x += basket.speed;
    if(basket.x < 0) basket.x = 0;
    if(basket.x > W - basket.width) basket.x = W - basket.width;

    // Move bee down
    if(bee && running){
      bee.y += beeSpeed;

      // Check catch
      if(checkCatch()){
        nextIndex++;
        if(nextIndex >= LETTERS.length){
          bee = null;
          running = false;
          // Show birthday + fireworks first
          birthdayText.style.display = 'block';
          fireworksCanvas.style.display = 'block';
          dialog.style.display = 'none';
          finalMessage.hidden = true;
          nextLetterEl.textContent = '';

          launchFireworks();

          // After 4 seconds show "Do you love Foumi?"
          setTimeout(() => {
            birthdayText.style.display = 'none';
            fireworksCanvas.style.display = 'none';
            dialog.style.display = 'block';
            dialogText.textContent = 'Do you love Foumi?';
            yesButton.style.display = 'inline-block';
            finalMessage.hidden = true;
            showOverlay();
          }, 4000);
        } else {
          spawnBee();
        }
      } else if(bee.y - bee.radius > H){
        // Missed bee, retry same letter by respawning
        spawnBee();
      }
    }

    // Clear canvas
    ctx.clearRect(0,0,W,H);

    // Draw stars
    drawStars();

    // Draw bee
    if(bee) drawBee(bee);

    // Draw basket
    drawBasket();

    // Draw fireworks only after message complete
    if(!running){
      fwCtx.clearRect(0,0,fwWidth, fwHeight);
      fireworks.forEach(fw => {
        fw.update(dt);
        fw.draw(fwCtx);
      });
      fireworks = fireworks.filter(fw => !fw.isDone());

      if(fireworks.length === 0){
        // Relaunch fireworks every 1.5 sec if dialog not visible
        if(dialog.style.display === 'none'){
          launchFireworks();
        }
      }
    }

    // Update HUD letter
    if(running){
      nextLetterEl.textContent = LETTERS[nextIndex];
    }

    if(running) requestAnimationFrame(gameLoop);
  }

  // Resize stars and fireworks canvas
  function resizeCanvases(){
    starsCanvas.width = window.innerWidth;
    starsCanvas.height = window.innerHeight;

    fireworksCanvas.width = 480;
    fireworksCanvas.height = 200;
  }
  window.addEventListener('resize', () => {
    resizeCanvases();
    initStars();
  });
  resizeCanvases();
  initStars();

  spawnBee();
  requestAnimationFrame(gameLoop);
})();
</script>
</body>
</html>
